// Generated by CoffeeScript 1.6.1
(function() {
  var currentUser, init, loginFunction, logoutFunction, showPrivatePage, showPublicPage;

  init = function() {
    var watchOptions;
    watchOptions = {
      onlogin: loginFunction,
      onlogout: logoutFunction,
      loggedInUser: currentUser
    };
    return navigator.id.watch(watchOptions);
  };

  loginFunction = function(assertion) {
    return $.post('/verify', {
      assertion: assertion
    }, function(response) {
      if (response === 'yes') {
        return showPrivatePage();
      } else if (response === 'no') {
        return alert('Uh oh. Sign-in failed!');
      }
    });
  };

  showPrivatePage = function() {
    $('#login').hide();
    $('#logout').show();
    return $('#content').load('/private');
  };

  logoutFunction = function() {
    showPublicPage();
    return $.post('/logout');
  };

  showPublicPage = function() {
    $('#login').show();
    $('#logout').hide();
    return $('#content').html('');
  };

  currentUser = null;

  $.get('/whoami', function(email) {
    if (email === 'idk') {
      showPublicPage();
    } else {
      currentUser = email;
      showPrivatePage();
    }
    return init();
  });

  $('#login').click(function() {
    return navigator.id.request();
  });

  $('#logout').click(function() {
    return navigator.id.logout();
  });

}).call(this);
